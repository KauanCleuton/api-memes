<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>API Meme</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/resize-image/2.3.1/resize-image.min.js"></script>
</head>

<body>
  <h1>Meme Generator</h1>
  <form enctype="multipart/form-data" action="/memes" method="POST">
    <label for="caption">Caption:</label>
    <input type="text" id="caption" name="caption" required>
    <br>
    <label for="image">Choose an image:</label>
    <input type="file" id="image" name="image" accept=".jpg, .jpeg, .png" required>
    <br>
    <button type="submit" class="button-submit">Generate Meme</button>
  </form>

  <h2>Generated Memes</h2>
  <div id="memes-container" class="gallery"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const memesContainer = document.querySelector('#memes-container');
      const buttonSubmit = document.querySelector(".button-submit");
      const captionInput = document.getElementById('caption');
      const imageInput = document.getElementById('image');

      buttonSubmit.addEventListener('click', (event) => {
        event.preventDefault();

        const formData = new FormData();
        formData.append('caption', captionInput.value);
        formData.append('image', imageInput.files[0]);

        fetch('/memes', {
          method: 'POST',
          body: formData,
        })
          .then((response) => {
            if (response.ok) {
              return response.json();
            } else {
              throw new Error('Failed to generate meme.');
            }
          })
          .then((newMeme) => {
            displayMeme(newMeme);
            captionInput.value = '';
            imageInput.value = '';
          })
          .catch((error) => {
            console.error(error.message);
          });
      });

      function displayMeme(meme) {
        const memeDiv = document.createElement('div');
        memeDiv.classList.add('meme'); // Adiciona a classe .meme ao elemento div do meme
        const captionHeading = document.createElement('h3');
        const memeImage = document.createElement('img');

        captionHeading.textContent = meme.caption;
        memeImage.src = meme.imagem;
        memeImage.alt = 'Generated Meme';

        memeDiv.appendChild(captionHeading);
        memeDiv.appendChild(memeImage);
        memesContainer.appendChild(memeDiv);
      }
    });
  </script>
</body>

</html>